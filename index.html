<!doctype html><html><head><meta charset="utf-8"/><title>Bookish</title><meta name="viewport" content="width=device-width,initial-scale=1"/>
<link rel="manifest" href="manifest.json"/>
<meta name="theme-color" content="#2563eb"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="default"/>
<link rel="apple-touch-icon" href="assets/icons/icon-192.png"/>
<link rel="icon" type="image/png" sizes="32x32" href="assets/icons/icon-192.png"/>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Fraunces:opsz,wght@9..144,400;9..144,500;9..144,600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/styles.css"/>
</head><body><div id="app">
<header>
  <h1>Bookish</h1>
  <div style="display:flex;align-items:center;gap:10px;font-size:.65rem">
    <div id="status" style="display:none"></div>
    <button id="installBtn" class="refresh-link" style="display:none" title="Install">Install</button>
    <button id="syncNowBtn" class="refresh-link" title="Sync now" style="display:none">Sync</button>
    <button id="accountBtn" class="refresh-link account-link" title="Account">Account</button>
    <button id="geekBtn" class="refresh-link" title="Developer mode" aria-controls="geekPanel">âš™ï¸Ž</button>
  </div>
</header>
<!-- status banner removed; status now shown inside geek panel -->
<div id="geekPanel" class="geek-panel" style="display:none">
  <div class="geek-header">
    <span class="geek-title">Network</span>
    <span id="geekBody" class="geek-stats"></span>
    <button id="geekClose" class="geek-close" title="Turn off developer mode">&times;</button>
  </div>
  <div id="geekStatusLine" class="geek-status-line"></div>
</div>
<div style="display:flex;gap:8px;margin:4px 0 12px">
  <button id="newBtn" class="new-compact" title="Add new">ï¼‹ New</button>
</div>
<div id="accountBanner" class="account-banner" role="button" tabindex="0" style="display:none;"></div>
<div id="accountNudgeBanner" class="nudge-banner" style="display:none;">
  <div class="nudge-content">
    <span class="nudge-icon">ðŸ’¡</span>
    <div class="nudge-text">
      <div class="nudge-headline">Want to access your books from other devices?</div>
      <button id="nudgeCreateAccountBtn" class="btn-link nudge-cta">Create Free Account â†’</button>
    </div>
  </div>
  <button id="nudgeDismissBtn" class="nudge-dismiss" title="Dismiss">Ã—</button>
</div>

<!-- Account Modal -->
<div id="accountModal" class="modal-overlay" style="display:none;">
  <div class="modal-backdrop"></div>
  <div class="modal account-modal">
    <button class="modal-close" id="accountModalClose" aria-label="Close">Ã—</button>
    <div id="accountModalContent"></div>
  </div>
</div>

<div id="cards" class="cards"></div>
<div id="empty" class="empty-state" style="display:none">
  <div class="empty-illustration">ðŸ“š</div>
  <h2 class="empty-headline">Your reading journey starts here</h2>
  <p class="empty-subtext">Your personal reading list â€” encrypted, permanent, and truly yours.</p>
  <button id="emptyAddBookBtn" class="btn primary empty-cta">Add Your First Book</button>
  <p class="empty-hint">No sign-up needed. Start adding books right away.</p>
</div>
<div id="celebrationToast" class="toast celebration-toast" style="display:none;">
  <span class="toast-icon">ðŸŽ‰</span>
  <span class="toast-message">First book added! You're on your way.</span>
</div>
<footer>Bookish â€¢ Alpha â€¢ v0.1.17</footer>
</div>

<div id="modal" class="modal">
  <div class="modal-inner">
    <button class="close" id="closeModal">Ã—</button>
    <div id="bookSearchUI">
      <h3>Lookup Book</h3>
      <input id="bookSearchInput" placeholder="Search titleâ€¦" autocomplete="off"/>
      <div id="searchControls" class="search-controls" style="display:none">
        <div class="filters">
          <span class="tiny-label">Filter:</span>
          <button type="button" class="filter-btn active" data-filter="all">All</button>
          <button type="button" class="filter-btn" data-filter="audiobook">Audio</button>
          <button type="button" class="filter-btn" data-filter="paperback">Paperback</button>
          <button type="button" class="filter-btn" data-filter="hardcover">Hardcover</button>
        </div>
        <div class="sorters">
          <span class="tiny-label">Sort:</span>
          <button type="button" class="sort-btn active" data-mode="relevance" title="Original relevance order">Relevance</button>
          <button type="button" class="sort-btn" data-mode="newest" title="Newest year first">Newest</button>
        </div>
      </div>
      <div id="bookSearchResults" style="display:none"></div>
      <div id="editionNav">
        <button type="button" id="prevEdition">â—€</button>
        <div id="editionInfo"></div>
        <button type="button" id="nextEdition">â–¶</button>
      </div>
    </div>
    <form id="entryForm" class="inline" novalidate>
      <div class="form-as-tile">
        <div class="tile-cover" id="tileCoverClick">
          <img class="preview" id="coverPreview" style="display:none"/>
          <div class="placeholder" id="coverPlaceholder"><div class="placeholder-icon"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg><span>Click or search to add cover</span></div></div>
          <input type="file" name="coverFile" accept="image/*" style="display:none" id="hiddenCoverInput"/>
        </div>
        <div class="fields-cluster">
          <div class="field-block"><label>Title</label><input name="title" required placeholder="Title"></div>
          <div class="field-block"><label>Author</label><input name="author" required placeholder="Author"></div>
            <div class="field-block"><label>Edition</label><input name="edition" placeholder="Edition / Year"></div>
          <div class="field-block"><label>Format</label><select name="format"><option>paperback</option><option>hardcover</option><option>ebook</option><option>audiobook</option><option>other</option></select></div>
          <div class="field-block"><label>Date Read</label><div class="date-input-wrap"><input name="dateRead" type="date"><button type="button" class="cal-btn" id="openCalendarBtn" title="Pick date">ðŸ“…</button></div></div>
        </div>
      </div>
      <input type="hidden" name="priorTxid"/>
      <div class="row-actions primary-actions">
        <button type="submit" class="btn" id="saveBtn" disabled>Save</button>
        <button type="button" class="btn secondary edit-only" id="cancelBtn">Cancel</button>
        <button type="button" class="btn danger edit-only" id="deleteBtn" title="Soft delete (tombstone)">Delete</button>
      </div>
    </form>
  </div>
</div>
<script>
 if('serviceWorker' in navigator){
  window.addEventListener('load',async()=>{
    try{
      const registration=await navigator.serviceWorker.register('./sw.js');
      // Check for updates on page load
      registration.update();
      // Check for updates periodically (every 60 minutes)
      setInterval(()=>registration.update(),60*60*1000);
    }catch(err){
      console.warn('SW registration failed:',err);
    }
  });
  // Reload when new service worker takes control
  let refreshing=false;
  navigator.serviceWorker.addEventListener('controllerchange',()=>{
    if(refreshing) return;
    refreshing=true;
    window.location.reload();
  });
 }
 // Minimal install prompt handling
 let deferredPrompt; const installBtn=document.getElementById('installBtn');
 window.addEventListener('beforeinstallprompt', (e)=>{ e.preventDefault(); deferredPrompt=e; installBtn.style.display='inline-flex'; });
 installBtn?.addEventListener('click', async ()=>{ if(!deferredPrompt) return; installBtn.disabled=true; try{ deferredPrompt.prompt(); await deferredPrompt.userChoice; }finally{ installBtn.style.display='none'; deferredPrompt=null; }
 });
</script>
<!-- Arweave web bundle + browser client (serverless mode) -->
<script src="https://unpkg.com/arweave/bundles/web.bundle.min.js"></script>
<script type="module" src="js/browser_client.js"></script>
<script type="module" src="js/wallet.js"></script>
<script type="module" src="js/irys_client_browser.js"></script>
<script type="module" src="js/cache.js"></script>
<script type="module" src="js/sync_manager.js"></script>
<script type="module" src="js/app.js"></script>
<script defer src="js/date_picker.js"></script>
<script type="module" src="js/book_search.js"></script>
</body></html>
